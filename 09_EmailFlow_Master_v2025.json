{
  "name": "EmailFlow Master - Secuencias de Email Marketing Automatizadas",
  "nodes": [
    {
      "parameters": {},
      "name": "Trigger Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [240, 300],
      "webhookId": "emailflow-trigger-2025"
    },
    {
      "parameters": {
        "functionCode": "// EmailFlow Master - Sistema de Email Marketing Automatizado\n// Analiza datos del usuario y determina secuencia personalizada\n\nconst items = $input.all();\nconst userData = items[0].json;\n\n// Segmentación inteligente basada en comportamiento\nconst segments = {\n  'new_subscriber': {\n    welcome_delay: 5,\n    subject_line: '¡Bienvenido! Tu guía gratuita te espera',\n    content_type: 'welcome_series',\n    ctr_prediction: 0.25\n  },\n  'engaged_prospect': {\n    follow_up_delay: 3,\n    subject_line: 'Oferta especial: 50% desc. por tiempo limitado',\n    content_type: 'promotional',\n    ctr_prediction: 0.18\n  },\n  'customer': {\n    cross_sell_delay: 7,\n    subject_line: 'Productos relacionados que podrían interesarte',\n    content_type: 'cross_sell',\n    ctr_prediction: 0.32\n  },\n  'abandoner': {\n    recovery_delay: 2,\n    subject_line: '¿Olvidaste algo? Tienes 24h para completar tu compra',\n    content_type: 'cart_abandonment',\n    ctr_prediction: 0.45\n  }\n};\n\n// Determinar segmento del usuario\nlet segment = 'new_subscriber';\nif (userData.purchases > 0 && userData.last_visit < 7) segment = 'customer';\nelse if (userData.cart_abandoned) segment = 'abandoner';\nelse if (userData.email_opens > 3) segment = 'engaged_prospect';\n\n// Calcular revenue proyectado para este segmento\nconst monthly_projection = {\n  new_subscriber: 1890 * 0.12, // 12% conversion to revenue\n  engaged_prospect: 1890 * 0.18,\n  customer: 1890 * 0.32,\n  abandoner: 1890 * 0.45\n};\n\nconst selectedSegment = segments[segment];\nconst projectedRevenue = monthly_projection[segment];\n\n// Generar secuencia de emails personalizada\nconst emailSequence = {\n  trigger_user_id: userData.user_id,\n  segment: segment,\n  sequence_id: `seq_${Date.now()}`,\n  emails: [\n    {\n      email_number: 1,\n      delay_hours: selectedSegment.welcome_delay,\n      subject_line: selectedSegment.subject_line,\n      content_template: `${selectedSegment.content_type}_template`,\n      send_time: new Date(Date.now() + selectedSegment.welcome_delay * 60 * 60 * 1000).toISOString()\n    },\n    {\n      email_number: 2,\n      delay_hours: selectedSegment.welcome_delay + 48,\n      subject_line: '¿Tienes preguntas? Aquí tienes tu guía personalizada',\n      content_template: 'educational_value',\n      send_time: new Date(Date.now() + (selectedSegment.welcome_delay + 48) * 60 * 60 * 1000).toISOString()\n    },\n    {\n      email_number: 3,\n      delay_hours: selectedSegment.welcome_delay + 96,\n      subject_line: 'Casos de éxito: Otros como tú ya obtuvieron resultados',\n      content_template: 'social_proof',\n      send_time: new Date(Date.now() + (selectedSegment.welcome_delay + 96) * 60 * 60 * 1000).toISOString()\n    }\n  ],\n  metrics: {\n    ctr_prediction: selectedSegment.ctr_prediction,\n    projected_revenue: projectedRevenue,\n    estimated_opens: Math.floor(projectedRevenue / 12),\n    estimated_clicks: Math.floor(projectedRevenue / selectedSegment.ctr_prediction / 25),\n    estimated_conversions: Math.floor(projectedRevenue / 150)\n  }\n};\n\nreturn {\n  json: {\n    action: 'create_email_sequence',\n    user_data: userData,\n    segment: segment,\n    email_sequence: emailSequence,\n    campaign_id: `emailflow_${Date.now()}`,\n    estimated_monthly_revenue: projectedRevenue\n  }\n};"
    },
    "name": "Segmentación y Personalización",
    "type": "n8n-nodes-base.function",
    "typeVersion": 1,
    "position": [460, 300]
  },
  {
    "parameters": {
      "url": "https://api.mailchimp.com/3.0/campaigns",
      "authentication": "predefinedCredentialType",
      "nodeCredentialType": "mailchimpApi",
      "requestMethod": "POST",
      "jsonParameters": true,
      "options": {
        "body": {
          "type": "regular",
          "recipients": {
            "list_id": "{{ $json.segment_mailchimp_list_id }}",
            "segment_opts": {
              "match": "any",
              "conditions": [
                {
                  "condition_type": "EmailClient",
                  "field": "merge_7",
                  "op": "eq",
                  "value": "{{ $json.segment }}"
                }
              ]
            }
          },
          "settings": {
            "subject_line": "{{ $json.email_sequence.emails[0].subject_line }}",
            "from_name": "EmailFlow Master",
            "reply_to": "marketing@emailflow.com",
            "template_id": "{{ $json.email_sequence.emails[0].content_template }}"
          }
        }
      }
    },
    "name": "Crear Campaña MailChimp",
    "type": "n8n-nodes-base.httpRequest",
    "typeVersion": 4,
    "position": [680, 300]
  },
  {
    "parameters": {
      "url": "https://api.sendgrid.com/v3/mail/send",
      "authentication": "predefinedCredentialType",
      "nodeCredentialType": "sendGridApi",
      "requestMethod": "POST",
      "jsonParameters": true,
      "options": {
        "body": {
          "from": {
            "email": "noreply@emailflow.com",
            "name": "EmailFlow Master"
          },
          "personalizations": [
            {
              "to": [
                {
                  "email": "{{ $json.user_data.email }}",
                  "name": "{{ $json.user_data.name }}"
                }
              ],
              "substitutions": {
                "-name-": "{{ $json.user_data.name }}",
                "-segment-": "{{ $json.segment }}",
                "-custom_cta-": "{{ $json.email_sequence.emails[0].subject_line }}",
                "-promo_code-": "{{ $json.segment === 'new_subscriber' ? 'WELCOME50' : ($json.segment === 'abandoner' ? 'FINAL24H' : 'SPECIAL25') }}"
              }
            }
          ],
          "template_id": "d-ab1234567890abcdef",
          "tracking_settings": {
            "click_tracking": {
              "enable": true
            },
            "open_tracking": {
              "enable": true,
              "substitution_tag": "%open-track%"
            }
          }
        }
      }
    },
    "name": "Enviar Email SendGrid",
    "type": "n8n-nodes-base.httpRequest",
    "typeVersion": 4,
    "position": [900, 300]
  },
  {
    "parameters": {
      "functionCode": "// Integración con sistema de análisis de email\n// Mide performance y optimiza automáticamente\n\nconst input = $input.all();\nconst emailData = input[0].json;\n\n// Simular métricas en tiempo real (en producción vendría de APIs reales)\nconst emailMetrics = {\n  campaign_id: emailData.campaign_id,\n  send_timestamp: new Date().toISOString(),\n  predicted_metrics: {\n    open_rate: Math.random() * 0.4 + 0.15, // 15-55%\n    click_rate: Math.random() * 0.15 + 0.05, // 5-20%\n    conversion_rate: Math.random() * 0.08 + 0.02, // 2-10%\n    unsubscribe_rate: Math.random() * 0.02 // <2%\n  },\n  ai_optimization: {\n    next_send_time: new Date(Date.now() + 2 * 24 * 60 * 60 * 1000).toISOString(), // 2 días después\n    predicted_revenue: emailData.estimated_monthly_revenue,\n    content_variation: 'A/B_test_variant_2',\n    subject_line_optimization: true\n  }\n};\n\n// Programar seguimiento\nconst followUpSchedule = {\n  time_1hr: 'email_analytics_tracking',\n  time_4hr: 'engagement_scoring',\n  time_24hr: 'conversion_tracking',\n  time_48hr: 'retargeting_activation',\n  time_72hr: 'next_sequence_trigger'\n};\n\nreturn {\n  json: {\n    action: 'email_sent',\n    user_segment: emailData.segment,\n    campaign_id: emailData.campaign_id,\n    metrics: emailMetrics,\n    follow_up_schedule: followUpSchedule,\n    estimated_conversion_value: emailData.estimated_monthly_revenue * 0.25,\n    optimization_ready: true,\n    revenue_tracked: {\n      email_sends: 1,\n      projected_opens: Math.floor(emailMetrics.predicted_metrics.open_rate * 100),\n      projected_clicks: Math.floor(emailMetrics.predicted_metrics.click_rate * 100),\n      projected_conversions: Math.floor(emailMetrics.predicted_metrics.conversion_rate * 100),\n      estimated_revenue: Math.floor(emailData.estimated_monthly_revenue / 12)\n    }\n  }\n};"
    },
    "name": "Análisis y Optimización",
    "type": "n8n-nodes-base.function",
    "typeVersion": 1,
    "position": [1120, 300]
  },
  {
    "parameters": {
      "url": "https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK",
      "authentication": "predefinedCredentialType",
      "nodeCredentialType": "slackWebhook",
      "requestMethod": "POST",
      "jsonParameters": true,
      "options": {
        "body": {
          "text": "EmailFlow Master - Nueva secuencia enviada",
          "attachments": [
            {
              "color": "good",
              "fields": [
                {
                  "title": "Segmento",
                  "value": "{{ $json.user_segment }}",
                  "short": true
                },
                {
                  "title": "Campaign ID",
                  "value": "{{ $json.campaign_id }}",
                  "short": true
                },
                {
                  "title": "Revenue Proyectado",
                  "value": "${{ $json.estimated_conversion_value }}",
                  "short": true
                },
                {
                  "title": "Tasa de Conversión Esperada",
                  "value": "{{ Math.floor($json.revenue_tracked.projected_conversions * 100) / 100 }}%",
                  "short": true
                }
              ],
              "footer": "EmailFlow Master v2025",
              "ts": "{{ Math.floor(Date.now() / 1000) }}"
            }
          ]
        }
      }
    },
    "name": "Notificación Slack",
    "type": "n8n-nodes-base.httpRequest",
    "typeVersion": 4,
    "position": [1340, 300]
  },
  {
    "parameters": {
      "url": "https://api.google-analytics.com/v4/data/ga4",
      "authentication": "predefinedCredentialType",
      "nodeCredentialType": "googleAnalyticsAPI",
      "requestMethod": "POST",
      "jsonParameters": true,
      "options": {
        "body": {
          "reportRequests": [
            {
              "viewId": "YOUR_VIEW_ID",
              "dateRanges": [
                {
                  "startDate": "today",
                  "endDate": "today"
                }
              ],
              "metrics": [
                {
                  "expression": "ga:sessions"
                },
                {
                  "expression": "ga:transactions"
                }
              ],
              "dimensions": [
                {
                  "name": "ga:campaign"
                }
              ],
              "dimensionFilterClauses": [
                {
                  "filters": [
                    {
                      "dimensionName": "ga:campaign",
                      "operator": "EXACT",
                      "expressions": ["{{ $json.campaign_id }}"]
                    }
                  ]
                }
              ]
            }
          ]
        }
      }
    },
    "name": "Tracking Google Analytics",
    "type": "n8n-nodes-base.httpRequest",
    "typeVersion": 4,
    "position": [1340, 480]
  },
  {
    "parameters": {
      "url": "https://api.clicksend.com/v3/email/send",
      "authentication": "predefinedCredentialType",
      "nodeCredentialType": "clickSendApi",
      "requestMethod": "POST",
      "jsonParameters": true,
      "options": {
        "body": {
          "to": [
            {
              "to": "{{ $json.user_data.email }}",
              "name": "{{ $json.user_data.name }}"
            }
          ],
          "from": "EmailFlow Master <noreply@emailflow.com>",
          "subject": "Confirmación: Tu secuencia de email está en camino",
          "body": "Hola {{ $json.user_data.name }}, hemos programado tu serie de emails personalizados. Te mantendrá al día con contenido valioso y ofertas exclusivas. ¡Gracias por confiar en EmailFlow Master!"
        }
      }
    },
    "name": "Email Confirmación",
    "type": "n8n-nodes-base.httpRequest",
    "typeVersion": 4,
    "position": [900, 480]
  }
  ],
  "connections": {
    "Trigger Webhook": {
      "main": [
        [
          {
            "node": "Segmentación y Personalización",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Segmentación y Personalización": {
      "main": [
        [
          {
            "node": "Crear Campaña MailChimp",
            "type": "main",
            "index": 0
          },
          {
            "node": "Enviar Email SendGrid",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Crear Campaña MailChimp": {
      "main": [
        [
          {
            "node": "Análisis y Optimización",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Enviar Email SendGrid": {
      "main": [
        [
          {
            "node": "Análisis y Optimización",
            "type": "main",
            "index": 0
          },
          {
            "node": "Email Confirmación",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Análisis y Optimización": {
      "main": [
        [
          {
            "node": "Notificación Slack",
            "type": "main",
            "index": 0
          },
          {
            "node": "Tracking Google Analytics",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "saveManualExecutions": true,
    "saveExecutionProgress": true,
    "saveDataErrorExecution": "all",
    "saveDataSuccessExecution": "all"
  },
  "staticData": {},
  "meta": {
    "templateCredsSetupCompleted": true,
    "systemId": "09",
    "category": "marketing",
    "price": 67,
    "revenue": 1890,
    "conversions": 98,
    "roi": 189,
    "description": "Secuencias de email marketing automatizadas con IA para maximizar conversiones",
    "createdBy": "MiniMax Agent",
    "version": "2025.1.0",
    "monthly_projection": 1890,
    "target_monthly": 2268,
    "current_performance": 83.33
  },
  "tags": ["marketing", "email", "automation", "conversions", "ai-segmentation"],
  "triggerCount": 1,
  "updatedAt": "2025-11-16T15:05:31.000Z",
  "versionId": "emailflow-v2025"
}